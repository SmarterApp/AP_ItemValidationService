/*
 * Copyright 2017 Regents of the University of California. Licensed under the Educational Community License, Version
 * 2.0 (the "license"); you may not use this file except in compliance with the License. You may obtain a copy of the
 * license at
 *
 * https://opensource.org/licenses/ECL-2.0
 *
 * Unless required under applicable law or agreed to in writing, software distributed under the License is distributed
 * in an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for
 * specific language governing permissions and limitations under the license.
 */
package org.opentestsystem.ap.ivs.client;

import java.util.List;

import feign.Feign;
import feign.Headers;
import feign.Logger;
import feign.RequestLine;
import feign.gson.GsonDecoder;
import feign.gson.GsonEncoder;
import feign.slf4j.Slf4jLogger;
import org.opentestsystem.ap.common.model.ValidationError;
import org.springframework.cloud.netflix.feign.FeignClient;

/**
 * Client for making REST calls into CPT.
 */
@FeignClient("cpt")
public interface CptApi {

    /**
     * Requests CPT to validate an item.  It is given a path to the item on disk where CPT can validate it.  CPT
     * responds with a list of errors or an empty list if no errors.
     *
     * @param request The validation request.
     * @return A list of validation errors associated with an item.
     */
    @RequestLine("POST /validation")
    @Headers("Content-Type: application/json")
    List<ValidationError> validateItem(CptValidationRequest request);

    static Logger logger() {
        return new Slf4jLogger(CptApi.class);
    }

    static CptApi connect(final String host, final String apiVersion) {
        return Feign.builder()
            .decoder(new GsonDecoder())
            .encoder(new GsonEncoder())
            .logger(logger())
            .logLevel(Logger.Level.FULL)
            .target(CptApi.class, host + apiVersion);
    }


}
